<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>প্রিমিয়াম কোর্স ভিডিও | লার্নিং প্ল্যাটফর্ম</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/video.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <img src="img/logo.jpg" alt="Logo" class="logo-img">
                <span class="logo-text">আব্দুর রহমান</span>
            </div>
            <div class="auth-status">
                <div class="user-avatar">AR</div>
            </div>
        </header>
        
        <div class="player-container">
            <div class="main-player">
                <div class="video-wrapper">
                    <div class="drm-protected">
                        <i class="fas fa-lock"></i>
                        DRM প্রোটেক্টেড
                    </div>
                    <video id="main-video" class="main-video" controls controlsList="nodownload nofullscreen noremoteplayback" disablePictureInPicture>
                        <source src="" type="video/mp4">
                        আপনার ব্রাউজার ভিডিও ট্যাগ সাপোর্ট করে না।
                    </video>
                    <div class="video-watermark">
                        <i class="fas fa-user-shield"></i> user@example.com
                    </div>
                    <div class="video-controls-overlay" id="password-overlay">
                        <h3>ছোট্ট একটি প্রশ্ন করি...</h3>
                        <p>বল তো <span id="firstNumber">5</span>+<span id="secondNumber">3</span> = কত হবে..?</p>
                        <input type="number" class="password-input" placeholder="উত্তর লিখুন" id="video-password">
                        <button class="verify-btn" onclick="verifyPassword()">যাচাই করুন</button>
                    </div>
                </div>
                <div class="video-info">
                    <h1 class="course-title">ডাটা সায়েন্স এন্ড মেশিন লার্নিং</h1>
                    <div class="module-title">
                        <i class="fas fa-folder-open"></i>
                        <span id="module-title">মডিউল ১: ভূমিকা ও বেসিক কনসেপ্ট</span>
                    </div>
                    <p class="video-description" id="video-description">
                        প্লেলিস্ট থেকে আপনার কাঙ্ক্ষিত ভিডিও লেকচারটি নির্বাচন করুন। প্রতিটি ভিডিওতে কোর্সের গুরুত্বপূর্ণ বিষয়বস্তু বিস্তারিতভাবে আলোচনা করা হয়েছে।
                    </p>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>কোর্স সম্পূর্ণতা</span>
                            <span>৩৫% সম্পূর্ণ</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="playlist">
                <div class="playlist-header">
                    <span class="playlist-title">কোর্স কন্টেন্ট</span>
                    <span class="playlist-count">১২ টি</span>
                </div>
                <div class="playlist-scroll">
                    <div class="module-group">
                        <div class="module-header">
                            <span>মডিউল ১: ভূমিকা ও বেসিক কনসেপ্ট</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="module-content">
                            <div class="playlist-item active" 
                                onclick="playVideo(this, 'secure_video_1.mp4', 'কোর্স ওভারভিউ', 'ডাটা সায়েন্স এন্ড মেশিন লার্নিং কোর্সের সম্পূর্ণ রোডম্যাপ এবং শেখার পদ্ধতি সম্পর্কে বিস্তারিত আলোচনা।', 'মডিউল ১: ভূমিকা ও বেসিক কনসেপ্ট')">
                                <div class="playlist-item-number">১</div>
                                <div class="playlist-item-info">
                                    <div class="playlist-item-title">কোর্স ওভারভিউ</div>
                                    <div class="playlist-item-duration">
                                        <i class="far fa-clock"></i> ১৫:৩০
                                    </div>
                                </div>
                                <div class="playlist-item-lock">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                            <div class="playlist-item" 
                                onclick="playVideo(this, 'secure_video_2.mp4', 'ডাটা সায়েন্স কি?', 'ডাটা সায়েন্সের মৌলিক ধারণা, ইতিহাস এবং বর্তমান বিশ্বে এর প্রয়োগ সম্পর্কে জানুন।', 'মডিউল ১: ভূমিকা ও বেসিক কনসেপ্ট')">
                                <div class="playlist-item-number">২</div>
                                <div class="playlist-item-info">
                                    <div class="playlist-item-title">ডাটা সায়েন্স কি?</div>
                                    <div class="playlist-item-duration">
                                        <i class="far fa-clock"></i> ২২:১৫
                                    </div>
                                </div>
                                <div class="playlist-item-lock">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                            <div class="playlist-item" 
                                onclick="playVideo(this, 'secure_video_3.mp4', 'মেশিন লার্নিং এর প্রকারভেদ', 'সুপারভাইজড, আনসুপারভাইজড এবং রিইনফোর্সমেন্ট লার্নিং সম্পর্কে বিস্তারিত আলোচনা।', 'মডিউল ১: ভূমিকা ও বেসিক কনসেপ্ট')">
                                <div class="playlist-item-number">৩</div>
                                <div class="playlist-item-info">
                                    <div class="playlist-item-title">মেশিন লার্নিং এর প্রকারভেদ</div>
                                    <div class="playlist-item-duration">
                                        <i class="far fa-clock"></i> ১৮:৪৫
                                    </div>
                                </div>
                                <div class="playlist-item-lock">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="module-group">
                        <div class="module-header collapsed">
                            <span>মডিউল ২: প্রোগ্রামিং বেসিকস</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="module-content" style="display: none;">
                            <div class="playlist-item" 
                                onclick="playVideo(this, 'secure_video_4.mp4', 'পাইথন বেসিকস', 'ডাটা সায়েন্সের জন্য প্রয়োজনীয় পাইথন প্রোগ্রামিং এর মৌলিক ধারণা।', 'মডিউল ২: প্রোগ্রামিং বেসিকস')">
                                <div class="playlist-item-number">৪</div>
                                <div class="playlist-item-info">
                                    <div class="playlist-item-title">পাইথন বেসিকস</div>
                                    <div class="playlist-item-duration">
                                        <i class="far fa-clock"></i> ৩০:২০
                                    </div>
                                </div>
                                <div class="playlist-item-lock">
                                    <i class="fas fa-lock"></i>
                                </div>
                            </div>
                            <div class="playlist-item" 
                                onclick="playVideo(this, 'secure_video_5.mp4', 'নামপাই ও প্যান্ডাস', 'ডাটা ম্যানিপুলেশনের জন্য নামপাই ও প্যান্ডাস লাইব্রেরির ব্যবহার শিখুন।', 'মডিউল ২: প্রোগ্রামিং বেসিকস')">
                                <div class="playlist-item-number">৫</div>
                                <div class="playlist-item-info">
                                    <div class="playlist-item-title">নামপাই ও প্যান্ডাস</div>
                                    <div class="playlist-item-duration">
                                        <i class="far fa-clock"></i> ২৫:১০
                                    </div>
                                </div>
                                <div class="playlist-item-lock">
                                    <i class="fas fa-lock"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="security-notice">
                        <i class="fas fa-shield-alt"></i>
                        <span>এই কোর্সের সমস্ত কন্টেন্ট সুরক্ষিত। অননুমোদিত শেয়ারিং বা ডাউনলোড কপিরাইট আইনে শাস্তিযোগ্য অপরাধ।</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Password protection
        const passwordOverlay = document.getElementById('password-overlay');
        const videoElement = document.getElementById('main-video');
        const firstNumber = document.getElementById('firstNumber');
        const secondNumber = document.getElementById('secondNumber');

        function generateRandomNumbers() {
            const fn = Math.floor(Math.random() * 10);
            const sn = Math.floor(Math.random() * 10);
            firstNumber.textContent = fn;
            secondNumber.textContent = sn;
        }
        generateRandomNumbers();
        
        function verifyPassword() {
            const passwordInput = document.getElementById('video-password');
            const fn = parseInt(firstNumber.textContent);
            const sn = parseInt(secondNumber.textContent);
            const correctAnswer = fn + sn;
            // In a real implementation, this would verify with server
            if (parseInt(passwordInput.value) === correctAnswer) {
                passwordOverlay.style.display = 'none';
                initPlayer('mashup.mp4');
            } else {
                alert("ভুল উত্তর! আবার চেষ্টা করুন।");
                generateRandomNumbers();
            }
            passwordInput.value = '';
        }
        // Load video function starts here
        let currentToken = null;
        let currentExpires = 0;
        const videoPlayer = document.getElementById('main-video');

        async function initPlayer(videoName) {
            try {
                const { token, expires, url } = await getToken(videoName);
                currentToken = token;
                currentExpires = expires;
                
                videoPlayer.src = url;
                videoPlayer.load();
                
                // Set up refresh 5 minutes before expiration
                const refreshTime = (expires - 300) * 1000 - Date.now();
                if (refreshTime > 0) {
                    setTimeout(refreshToken, refreshTime);
                }
                
            } catch (error) {
                console.error('Player initialization failed:', error);
                alert('Failed to load video: ' + error.message);
            }
        }

        async function getToken(videoName) {
            const response = await fetch(`generate_token.php?video=${encodeURIComponent(videoName)}`);
            if (!response.ok) {
                throw new Error('Failed to get token');
            }
            return await response.json();
        }

        async function refreshToken() {
            try {
                const videoName = new URL(videoPlayer.src).searchParams.get('video');
                const { token, expires, url } = await getToken(videoName);
                
                currentToken = token;
                currentExpires = expires;
                
                // Schedule next refresh
                const refreshTime = (expires - 300) * 1000 - Date.now();
                if (refreshTime > 0) {
                    setTimeout(refreshToken, refreshTime);
                }
                
            } catch (error) {
                console.error('Token refresh failed:', error);
                // Retry after 1 minute
                setTimeout(refreshToken, 60000);
            }
        }

        // Handle token expiration
        videoPlayer.addEventListener('error', () => {
            if (videoPlayer.error && videoPlayer.error.code === MediaError.MEDIA_ERR_NETWORK) {
                refreshToken().then(() => {
                    videoPlayer.src = `secure_video.php?video=${encodeURIComponent(
                        new URL(videoPlayer.src).searchParams.get('video')
                    )}&token=${currentToken}&expires=${currentExpires}`;
                    videoPlayer.load();
                });
            }
        });
        // Handle video end



        // Module accordion functionality
        const moduleHeaders = document.querySelectorAll('.module-header');
        moduleHeaders.forEach(header => {
            header.addEventListener('click', () => {
                header.classList.toggle('collapsed');
                const content = header.nextElementSibling;
                if (content.style.display === 'none') {
                    content.style.display = 'flex';
                } else {
                    content.style.display = 'none';
                }
            });
        });
        
        // Video player functionality
        function playVideo(element, videoSrc, title, description, moduleTitle) {
            // Show password overlay for protected content
            if (element.querySelector('.fa-lock')) {
                passwordOverlay.style.display = 'flex';
                return;
            }
            
            // Update active state in playlist
            const playlistItems = document.querySelectorAll('.playlist-item');
            playlistItems.forEach(item => item.classList.remove('active'));
            element.classList.add('active');
            
            // Update video info
            document.getElementById('module-title').textContent = moduleTitle;
            document.getElementById('video-description').textContent = description;
            
            // In a real implementation, this would fetch from secure server
            videoElement.src = videoSrc;
            videoElement.load();
            videoElement.play();
            
            // Scroll the active item into view
            element.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // Disable right-click context menu
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
        
        // Disable keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
            if (e.key === 'F12' || 
                (e.ctrlKey && e.shiftKey && e.key === 'I') || 
                (e.ctrlKey && e.shiftKey && e.key === 'J') || 
                (e.ctrlKey && e.key === 'U')) {
                e.preventDefault();
                alert('এই ফিচারটি ডিজেবল করা আছে সিকিউরিটি কারণে।');
            }
        });
    </script>
</body>
</html>